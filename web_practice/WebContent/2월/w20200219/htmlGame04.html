<!DOCTYPE html>
<html lang="ko" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>게임만들기_4</title>
    <style media="screen">
      *{
        margin : 0;
      }
      canvas{background-color: #aaaaaa}
    </style>
    <script type="text/javascript">
      // 배경음악 객체
      var bgMusic = new Audio("../game/bgm1.mp3");
      // 총 발사 효과음
      var fireSound = new Audio("../game/GUNSHOT.wav");

      // 비명 배경음 객체
      var scream = new Audio("../game/scream/1.wav");


      var ca;
      var count =0;

      var bgImg1 = new Image();
      bgImg1.src = "../game/back1.gif";
      
      var bgImg2 = new Image();
      bgImg2.src = "../game/back1.gif";
      // 배경 좌표
      var bg1Y = 0;
      var bg2Y = 800;

      var rabbit1 = new Image();
      rabbit1.src = "../game/rabbit1.png";

      var rabbit2 = new Image();
      rabbit2.src = "../game/rabbit2.png";

      var rabbit3 = new Image();
      rabbit3.src = "../game/rabbit3.png";

      // 토끼 좌표를 변수 처리
      var rabbitX = 100;
      var rabbitY = 100;

      // 조준경 이미지 객체
      var target = new Image();
      target.src = "../game/snipe.png";

      // 조준경 좌표
      var targetX = 300;
      var targetY = 200;

      // 탄착지점 이미지
      var hole = new Image();
      hole.src = "../game/hole.png"

      var holeX = -300;
      var holeY = -300;

      window.onload = function(){
        var canvas = document.getElementById('mycanvas');
        ca = canvas.getContext('2d');
        canvas.onmousemove = moveTarget;
        canvas.onmousedown = shoot;
        // body태그 객체 얻어오기
        var body = document.body;
        // body.onkeydown = 함수명;   => 키보드가 입력이 들어오면 함수를 실행
        body.onkeydown = runRabbit;  //()를 빼고 함수이름만 선언해야함에 유의!

        window.setInterval(drawScreen, 100);
      }

      function drawScreen() {
        ca.drawImage(bgImg1, 0, bg1Y, 800, 600);
        ca.drawImage(bgImg2, 0, bg2Y, 800, 600);
       bg1Y += 5;
       bg2Y += 5;

       if(bg1Y >=600){
         bg1Y = -600;
         bg2Y = 0;
       }
       if(bg2Y >= 600){
         bg2Y = -600;
         bg1Y = 0;
       }


        count++;
        if(count%3==0){
          ca.drawImage(rabbit1, rabbitX, rabbitY, 80, 80);
        }else if(count%3==1){
          ca.drawImage(rabbit2, rabbitX, rabbitY, 80, 80);
        }else if (count%3==2) {
          ca.drawImage(rabbit3, rabbitX, rabbitY, 80, 80);
        }else{
          count = 0;
        }

        ca.drawImage(hole, holeX, holeY, 40, 40);
        ca.drawImage(target, targetX, targetY, 80, 80);
        
      }

      function runRabbit() {
        console.log(event.keyCode);

        if(event.keyCode==37) rabbitX-=5;
        else if (event.keyCode==38) rabbitY-=5;
        else if (event.keyCode==39) rabbitX+=5;
        else if (event.keyCode==40) rabbitY+=5;

      }

      function stratMusic(){
        // console.log("음악 시작");
        bgMusic.play()
      }

      function stopMusic(){
        // console.log("음악 끝");
        // console.dir(bgMusic);
        bgMusic.currentTime = 0;
        bgMusic.pause(); //잠시 멈춤
      }

      // 버튼 클릭해서 토끼 움직
      // function moveUp() {rabbitY-=10}
      // function moveLeft() {rabbitX-=10}
      // function moveRight() {rabbitX+=10}
      // function moveDown() {rabbitY+=10}
      function moveRabbit(m) {
        if(m=="up") rabbitY-=10;
        else if (m=="left") rabbitX-=10;
        else if (m=="right") rabbitX+=10;
        else if (m=="down") rabbitY+=10;
      }
      
      // 조준경 이벤트 처리
      function moveTarget(event){
        targetX = event.pageX-40;
        targetY = event.pageY-40;
      }

      function shoot(event){
        fireSound.currentTime = 0;
        fireSound.play();

        window.setTimeout(function(){
          scream.currentTime = 0;
          scream.play;
        }, 550);
        holeX = event.pageX-20;
        holeY = event.pageY-20;
        if(holeX >=rabbitX-10 && holeX <=rabbitX+50 && holeY >= rabbitY-10 && holeY <= rabbitY+50){
          console.log("맞춤");
        }
      }
    </script>
  </head>
  <body>
    <canvas id="mycanvas" width=800 height=600></canvas>
    <br>
    <input type="button" value="musicOn" onclick="stratMusic()">
    <input type="button" value="musicOff" onclick="stopMusic()">
    <br>
    &nbsp;&nbsp;&nbsp;&nbsp;<input type="button" value="▲" onclick="moveRabbit('up')"><br>
    <input type="button" value="◀" onclick="moveRabbit('left')">
    &nbsp;<input type="button" value="▶" onclick="moveRabbit('right')"><br>
    &nbsp;&nbsp;&nbsp;&nbsp;<input type="button" value="▼" onclick="moveRabbit('down')">
  </body>
</html>
